' Gambas class file

Public sAuswahlArray As String[]
Public Textgesamt As String

Public Sub Form_Open()
  ' was soll nach Öffnen des Fensters geschehen?
  TextBox2.Text = FMain.sBackupquelle
  FileView1.Dir = User.Home
  
  'Ladefunktion
  Dim hFile As Stream
  'Konfigurationsdatei wird automatisch angelegt
   If Exist("~/.data-backup.txt") = False Then
    Shell "touch ~/.data-backup.txt" Wait
  Endif
  'hier wird geladen und in Variablen gefüllt
  hFile = Open "~/.data-backup.txt" For Read

   Line Input #hFile, Textgesamt
   Print Textgesamt

  'Die ListBox (Array) mit den Daten füllen
  sAuswahlArray = Split(Textgesamt)
  ListBox1.List = sAuswahlArray

End


Public Sub Button1_Click()
  '' Speichern Knopf - was soll passieren
  Dim i As Integer
  Dim Text As String
  
  sAuswahlArray = ListBox1.List
  Wait 
  TextBox2.Text = ""
  
  If TextBox2.Text = ""
    For i = 0 To sAuswahlArray.Max
      Text = Text & " " & sAuswahlArray[i]
      Print Text
    Next
      FMain.sBackupquelle = Text
      Print "Backupquelle" & Text
  Endif 

  Wait 1
  Print "Das stand in der geladenen Textzeile aus der Datei:" & Textgesamt
  Textgesamt = sAuswahlArray.Join()
  Print "So wird abgespeichert:" & Textgesamt
  'Text in Datei speichern
  File.Save("~/.data-backup.txt", Textgesamt)

  Me.Close

End


Public Sub FileView1_Activate()
  'Doppelklick im FileView wechselt Verzeichnis
  Dim sVerzeichnis As String
  
  Print FileView1.Current
  sVerzeichnis = FileView1.Current
  FileView1.Dir = FileView1.Dir &/ sVerzeichnis
  Print FileView1.Dir
  FileView1.Reload

End


Public Sub FileView1_KeyPress()
  ''Strg + Esc = wechselt zurück zum Homeverzeichnis
  If Key.Code = Key.Escape And If Key.Control Then 
    FileView1.Dir = User.Home
  Else
    FileView1.Reload 
   ' ListBox1.List = sAuswahlArray  
  Endif

End


Public Sub FileView1_MouseDrag()
  'Drag n Drop Funktion - was soll an der Maus hängen?
  FileView1.Drag(FileView1.Current)

End

Public Sub ListBox1_Drop()
  'Drag n Drop - das fliegt in das Array in der ListBox, gleich mit Gänsefüßchen 
  ListBox1.Add(Quote(FileView1.Dir &/ FileView1.Current))

End

Public Sub ListBox1_DblClick()
  '' Element löschen mit Doppelklick
  Print ListBox1.Index
  If ListBox1.Index = -1 Then Return 
  ListBox1.Remove(ListBox1.Index)

End

Public Sub Button2_Click()
  'Liste komplett löschen
  ListBox1.SelectAll
  ListBox1.Clear
  Wait 
  
End
